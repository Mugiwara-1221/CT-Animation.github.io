
const coloredDataURL = localStorage.getItem("coloredCharacter");
const selectedChar = localStorage.getItem("selectedCharacter");

const sceneWrapper = document.querySelector(".scene-wrapper");

if (coloredDataURL && selectedChar) {
  const img = document.createElement("img");
  img.src = coloredDataURL;
  img.classList.add("character", selectedChar.toLowerCase());
  sceneWrapper.appendChild(img);

  if (selectedChar.toLowerCase() === "tortoise") {
    startTortoiseAnimation(img); // <-- animate outline on top
  }

} else {
  alert("No character image found. Please color your character first.");
}

// Clear storage to prevent reuse
localStorage.removeItem("coloredCharacter");
localStorage.removeItem("selectedCharacter");

// Function to animate outline frames for tortoise
function startTortoiseAnimation(underImage) {
  const frames = [
    "images/frames/tortoise/tortoise1.png",
    "images/frames/tortoise/tortoise2.png",
    "images/frames/tortoise/tortoise3.png",
    "images/frames/tortoise/tortoise4.png"
  ];

  const animCanvas = document.createElement("canvas");
  animCanvas.className = "animation-layer tortoise";
  sceneWrapper.appendChild(animCanvas);

  const ctx = animCanvas.getContext("2d");

  function resizeCanvas() {
    const bounds = underImage.getBoundingClientRect();
    animCanvas.width = underImage.width;
    animCanvas.height = underImage.height;
    animCanvas.style.left = underImage.style.left || underImage.offsetLeft + "px";
    animCanvas.style.top = underImage.style.top || underImage.offsetTop + "px";
  }

  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  let frameIndex = 0;
  const frameImages = frames.map(src => {
    const img = new Image();
    img.src = src;
    return img;
  });

  function drawFrame() {
    ctx.clearRect(0, 0, animCanvas.width, animCanvas.height);
    const frame = frameImages[frameIndex];
    if (frame.complete) {
      ctx.drawImage(frame, 0, 0, animCanvas.width, animCanvas.height);
    }
    frameIndex = (frameIndex + 1) % frameImages.length;
  }

  setInterval(drawFrame, 200); // Change frame every 200ms
}

